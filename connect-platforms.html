<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Conectar Plataformas - Prisma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: #0f1419;
        color: #fff;
        overflow-x: hidden;
        min-height: 100vh;
      }

      /* Prisma Background Effect */
      .prisma-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        overflow: hidden;
      }

      .beam {
        position: absolute;
        width: 800px;
        height: 800px;
        border-radius: 50%;
        filter: blur(100px);
        opacity: 0.3;
        animation: float 20s infinite ease-in-out;
      }

      .beam-1 {
        background: radial-gradient(circle, #0070cc 0%, transparent 70%);
        top: -200px;
        left: -200px;
        animation-delay: 0s;
      }

      .beam-2 {
        background: radial-gradient(circle, #66c0f4 0%, transparent 70%);
        top: 50%;
        right: -200px;
        animation-delay: 5s;
      }

      .beam-3 {
        background: radial-gradient(circle, #3b82f6 0%, transparent 70%);
        bottom: -200px;
        left: 50%;
        animation-delay: 10s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translate(0, 0) scale(1);
        }
        33% {
          transform: translate(50px, -50px) scale(1.1);
        }
        66% {
          transform: translate(-50px, 50px) scale(0.9);
        }
      }

      /* Content */
      .content-wrapper {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        padding: 40px 40px 30px;
        max-width: 1200px;
        margin: 0 auto;
      }

      /* Header */
      .header {
        margin-bottom: 32px;
        animation: fadeIn 0.6s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 12px;
        font-size: 24px;
      }

      .header h1 {
        font-size: 32px;
        font-weight: 700;
        color: #fff;
        margin-bottom: 8px;
      }

      .header p {
        font-size: 15px;
        color: #9ca3af;
        line-height: 1.5;
        max-width: 600px;
      }

      /* Platform Grid */
      .platforms-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 32px;
      }

      .platform-card {
        background: rgba(30, 35, 45, 0.6);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 20px;
        transition: all 0.3s ease;
        animation: slideUp 0.6s ease;
        animation-fill-mode: both;
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .platform-card:nth-child(1) {
        animation-delay: 0.1s;
      }
      .platform-card:nth-child(2) {
        animation-delay: 0.2s;
      }
      .platform-card:nth-child(3) {
        animation-delay: 0.3s;
      }
      .platform-card:nth-child(4) {
        animation-delay: 0.4s;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .platform-card:hover {
        border-color: rgba(96, 165, 250, 0.3);
        background: rgba(30, 35, 45, 0.8);
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
      }

      .platform-header {
        display: flex;
        align-items: center;
        gap: 14px;
      }

      .platform-icon {
        width: 52px;
        height: 52px;
        flex-shrink: 0;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
      }

      .icon-steam {
        background: linear-gradient(
          135deg,
          rgba(102, 192, 244, 0.2),
          rgba(102, 192, 244, 0.1)
        );
        color: #66c0f4;
      }

      .icon-playstation {
        background: linear-gradient(
          135deg,
          rgba(0, 112, 204, 0.2),
          rgba(0, 112, 204, 0.1)
        );
        color: #0070cc;
      }

      .icon-xbox {
        background: linear-gradient(
          135deg,
          rgba(16, 124, 16, 0.2),
          rgba(16, 124, 16, 0.1)
        );
        color: #107c10;
      }

      .icon-retro {
        background: linear-gradient(
          135deg,
          rgba(212, 160, 23, 0.2),
          rgba(212, 160, 23, 0.1)
        );
        color: #d4a017;
      }

      .platform-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .platform-name {
        font-size: 18px;
        font-weight: 700;
        color: #fff;
        margin-bottom: 3px;
      }

      .platform-description {
        font-size: 12px;
        color: #9ca3af;
        line-height: 1.3;
      }

      .connect-btn {
        width: 100%;
        padding: 10px 14px;
        background: linear-gradient(135deg, #10b981, #059669);
        border: none;
        border-radius: 10px;
        color: #fff;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .connect-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
      }

      .connect-btn:active {
        transform: translateY(0);
      }

      .connect-btn.connected {
        background: rgba(16, 185, 129, 0.2);
        border: 2px solid #10b981;
        color: #10b981;
        cursor: pointer;
      }

      .connect-btn.connected:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        background: rgba(239, 68, 68, 0.2);
        border-color: #ef4444;
        color: #ef4444;
      }

      .connect-btn.connected:hover i {
        animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-3px);
        }
        75% {
          transform: translateX(3px);
        }
      }

      .connect-btn i {
        margin-right: 8px;
      }

      .connect-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
      }

      .connect-btn:disabled:hover {
        box-shadow: none !important;
        background: linear-gradient(135deg, #10b981, #059669) !important;
        border-color: transparent !important;
      }

      .connect-btn.connected:disabled:hover {
        background: rgba(16, 185, 129, 0.2) !important;
        border-color: #10b981 !important;
      }

      /* Info Section */
      .info-section {
        background: rgba(30, 35, 45, 0.6);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(96, 165, 250, 0.2);
        border-radius: 16px;
        padding: 24px;
        animation: fadeIn 0.8s ease 0.5s both;
      }

      .info-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
        cursor: pointer;
        user-select: none;
      }

      .info-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }

      .info-header h3 {
        font-size: 16px;
        font-weight: 700;
        color: #fff;
        flex: 1;
      }

      .info-toggle {
        display: none;
        width: 24px;
        height: 24px;
        align-items: center;
        justify-content: center;
        color: #60a5fa;
        font-size: 14px;
        transition: transform 0.3s ease;
      }

      .info-toggle.rotated {
        transform: rotate(180deg);
      }

      .info-list {
        list-style: none;
        padding: 0;
        max-height: 500px;
        overflow: hidden;
        transition: max-height 0.4s ease, opacity 0.3s ease;
      }

      .info-list.collapsed {
        max-height: 0;
        opacity: 0;
        margin-top: -20px;
      }

      .info-list.collapsed {
        max-height: 0;
        opacity: 0;
      }

      .info-list li {
        font-size: 13px;
        color: #9ca3af;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding-left: 24px;
        position: relative;
      }

      .info-list li:last-child {
        border-bottom: none;
      }

      .info-list li:before {
        content: "•";
        position: absolute;
        left: 8px;
        color: #60a5fa;
        font-size: 18px;
        line-height: 1;
      }

      @media (max-width: 768px) {
        .content-wrapper {
          padding: 30px 20px;
        }

        .header h1 {
          font-size: 26px;
        }

        .header p {
          font-size: 14px;
        }

        .platforms-grid {
          grid-template-columns: 1fr;
          gap: 14px;
        }

        .platform-card {
          padding: 18px;
        }

        .platform-icon {
          width: 48px;
          height: 48px;
          font-size: 22px;
        }

        .platform-name {
          font-size: 16px;
        }

        .platform-description {
          font-size: 11px;
        }

        .info-section {
          padding: 0;
        }

        .info-header {
          margin-bottom: 0;
          transition: all 0.3s ease;
          justify-content: center;
          text-align: center;
          position: relative;
          min-height: 56px;
          display: flex;
          align-items: center;
          padding: 16px 20px;
          gap: 12px;
        }

        .info-header h3 {
          margin: 0;
          line-height: 1.2;
          padding: 0;
          flex: 0 0 auto;
        }

        .info-icon {
          position: static;
          transform: none;
          flex-shrink: 0;
        }

        .info-toggle {
          position: static;
          transform: none;
          flex-shrink: 0;
        }

        .info-header h3 {
          flex: initial;
        }

        .info-header.expanded {
          margin-bottom: 20px;
          justify-content: center;
          text-align: center;
          padding: 20px 20px 0 20px;
        }

        .info-header.expanded h3 {
          flex: 0 0 auto;
          line-height: normal;
          margin-bottom: 0;
        }

        .info-list {
          margin-top: 0;
          padding: 0 20px 20px 20px;
        }

        .info-list.collapsed {
          margin-bottom: 0;
        }

        .info-toggle {
          display: flex;
        }
      }

      @media (min-width: 769px) and (max-width: 1024px) {
        .platforms-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (min-width: 1025px) {
        .platforms-grid {
          grid-template-columns: repeat(2, 1fr);
          max-width: 900px;
          margin-left: auto;
          margin-right: auto;
        }
      }
    </style>
  </head>
  <body>
    <!-- Prisma Background -->
    <div class="prisma-bg">
      <div class="beam beam-1"></div>
      <div class="beam beam-2"></div>
      <div class="beam beam-3"></div>
    </div>

    <!-- Content -->
    <div class="content-wrapper">
      <!-- Header -->
      <div class="header">
        <div class="header-icon">
          <i class="fas fa-link"></i>
        </div>
        <h1>Vincular Conta</h1>
        <p>
          Conecte suas contas de jogos para sincronizar estatísticas e
          conquistas
        </p>
      </div>

      <!-- Platforms Grid -->
      <div class="platforms-grid">
        <!-- Steam -->
        <div class="platform-card">
          <div class="platform-header">
            <div class="platform-icon icon-steam">
              <i class="fab fa-steam"></i>
            </div>
            <div class="platform-info">
              <h3 class="platform-name">Steam</h3>
              <p class="platform-description">Vincule sua biblioteca Steam</p>
            </div>
          </div>
          <button class="connect-btn" data-platform="steam">Conectar</button>
        </div>

        <!-- PlayStation -->
        <div class="platform-card">
          <div class="platform-header">
            <div class="platform-icon icon-playstation">
              <i class="fab fa-playstation"></i>
            </div>
            <div class="platform-info">
              <h3 class="platform-name">PlayStation Network</h3>
              <p class="platform-description">Conecte sua conta PSN</p>
            </div>
          </div>
          <button class="connect-btn" data-platform="playstation">
            Conectar
          </button>
        </div>

        <!-- Xbox -->
        <div class="platform-card">
          <div class="platform-header">
            <div class="platform-icon icon-xbox">
              <i class="fab fa-xbox"></i>
            </div>
            <div class="platform-info">
              <h3 class="platform-name">Xbox Live</h3>
              <p class="platform-description">Conecte sua conta Xbox</p>
            </div>
          </div>
          <button class="connect-btn" data-platform="xbox">Conectar</button>
        </div>

        <!-- RetroAchievements -->
        <div class="platform-card">
          <div class="platform-header">
            <div class="platform-icon icon-retro">
              <i class="fas fa-trophy"></i>
            </div>
            <div class="platform-info">
              <h3 class="platform-name">RetroAchievements</h3>
              <p class="platform-description">Vincule RetroAchievements</p>
            </div>
          </div>
          <button class="connect-btn" data-platform="retro">Conectar</button>
        </div>
      </div>

      <!-- Info Section -->
      <div class="info-section">
        <div class="info-header" onclick="toggleInfoSection()">
          <div class="info-icon">
            <i class="fas fa-info"></i>
          </div>
          <h3>Por que vincular suas contas?</h3>
          <div class="info-toggle" id="infoToggle">
            <i class="fas fa-chevron-down"></i>
          </div>
        </div>
        <ul class="info-list" id="infoList">
          <li>Sincronize automaticamente suas estatísticas de jogo</li>
          <li>Acompanhe seu progresso em múltiplas plataformas</li>
          <li>Conecte-se com amigos de diferentes redes</li>
          <li>Receba notificações personalizadas sobre seus jogos</li>
        </ul>
      </div>
    </div>

    <!-- Load Environment Variables -->
    <script src="js/env-config.js"></script>

    <!-- Load Supabase Configuration and Platform Connections Manager -->
    <script src="js/supabase-config.js"></script>
    <script src="js/platform-connections.js"></script>

    <script>
      // Platform Connections Manager instance
      let connectionsManager;

      // Platform URLs
      const platformUrls = {
        steam: "https://steamcommunity.com/login",
        playstation: "https://id.sonyentertainmentnetwork.com/signin",
        xbox: "https://login.live.com/login.srf",
        retro: "https://retroachievements.org/login",
      };

      // Initialize on page load
      window.addEventListener("DOMContentLoaded", async function () {
        // Initialize info section for mobile
        initInfoSection();

        // Create connections manager instance
        connectionsManager = new PlatformConnectionsManager();

        // Initialize and load connections from Supabase
        try {
          await connectionsManager.init();
          console.log("Platform connections loaded successfully");

          // Check if all platforms are connected and redirect to dashboard
          if (connectionsManager.areAllConnected()) {
            console.log("All platforms connected, redirecting to dashboard...");
            setTimeout(() => {
              window.location.href = "dashboard.html";
            }, 500);
            return;
          }
        } catch (error) {
          console.error("Error initializing platform connections:", error);
        }

        // Setup button click handlers
        setupPlatformButtons();
      });

      // Setup platform button click handlers
      function setupPlatformButtons() {
        const buttons = document.querySelectorAll(".connect-btn");
        buttons.forEach((button) => {
          const platform = button.getAttribute("data-platform");

          button.addEventListener("click", async function () {
            // Check if already connected
            if (button.classList.contains("connected")) {
              // Disconnect
              if (
                confirm(
                  `Deseja desvincular sua conta ${getPlatformName(platform)}?`
                )
              ) {
                // Feedback visual de loading
                const originalHTML = button.innerHTML;
                button.innerHTML =
                  '<i class="fas fa-spinner fa-spin"></i> Desvinculando...';
                button.disabled = true;

                try {
                  await connectionsManager.disconnectPlatform(platform);
                  console.log(`✓ ${platform} desvinculada com sucesso`);
                } catch (error) {
                  console.error("Error disconnecting platform:", error);
                  alert("Erro ao desvincular plataforma. Tente novamente.");
                  button.innerHTML = originalHTML;
                } finally {
                  button.disabled = false;
                }
              }
            } else {
              // Connect
              // Feedback visual de loading
              const originalHTML = button.innerHTML;
              button.innerHTML =
                '<i class="fas fa-spinner fa-spin"></i> Conectando...';
              button.disabled = true;

              try {
                await connectionsManager.handlePlatformConnect(
                  platform,
                  platformUrls[platform]
                );
              } catch (error) {
                console.error("Error connecting platform:", error);
                alert("Erro ao conectar plataforma. Tente novamente.");
                button.innerHTML = originalHTML;
              } finally {
                button.disabled = false;
              }
            }
          });
        });
      }

      // Get platform display name
      function getPlatformName(platform) {
        const names = {
          steam: "Steam",
          playstation: "PlayStation Network",
          xbox: "Xbox Live",
          retro: "RetroAchievements",
        };
        return names[platform] || platform;
      }

      // Toggle info section (only on mobile)
      function toggleInfoSection() {
        if (window.innerWidth <= 768) {
          const infoList = document.getElementById("infoList");
          const infoToggle = document.getElementById("infoToggle");
          const infoHeader = document.querySelector(".info-header");

          infoList.classList.toggle("collapsed");
          infoToggle.classList.toggle("rotated");
          infoHeader.classList.toggle("expanded");
        }
      }

      // Initialize collapsed state on mobile
      function initInfoSection() {
        if (window.innerWidth <= 768) {
          const infoList = document.getElementById("infoList");
          infoList.classList.add("collapsed");
        }
      }

      // Re-check on window resize
      window.addEventListener("resize", function () {
        const infoList = document.getElementById("infoList");
        const infoToggle = document.getElementById("infoToggle");
        const infoHeader = document.querySelector(".info-header");

        if (window.innerWidth > 768) {
          // Desktop: always show
          infoList.classList.remove("collapsed");
          infoToggle.classList.remove("rotated");
          infoHeader.classList.remove("expanded");
        } else {
          // Mobile: keep collapsed if it was collapsed
          if (!infoList.classList.contains("collapsed")) {
            infoHeader.classList.add("expanded");
          }
        }
      });
    </script>
  </body>
</html>
